<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Qsu! - Rhythm Game v2.0</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">

    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; cursor: none; }
        
        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }

        #bg-video {
            position: absolute; top: 50%; left: 50%; min-width: 100%; min-height: 100%;
            width: auto; height: auto; z-index: -1; transform: translate(-50%, -50%);
            object-fit: cover; filter: brightness(0.3) contrast(1.1);
        }

        /* VuruÅŸ ParÄ±ltÄ±sÄ± (Cila 1) */
        #flash {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 2000; transition: opacity 0.1s;
        }

        /* Beat Pulse Efekti (Cila 3) */
        @keyframes beatPulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.02); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .pulse-active { animation: beatPulse 0.5s infinite ease-in-out; }

        /* Ana MenÃ¼ */
        #menu { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.95) 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: 0.5s; }
        .menu-content { text-align: center; }
        h1 { font-size: 85px; letter-spacing: 20px; margin: 0; font-weight: 900; text-shadow: 0 0 30px rgba(0,210,255,0.4); }
        .version-badge { background: #00d2ff; color: black; padding: 5px 15px; border-radius: 50px; font-size: 12px; font-weight: bold; letter-spacing: 2px; display: inline-block; margin-bottom: 40px; }
        
        .btn-list { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); padding: 18px 60px; color: #fff; font-size: 18px; cursor: pointer; font-weight: bold; width: 400px; transition: 0.3s; border-radius: 10px; backdrop-filter: blur(5px); }
        .btn:hover { background: #00d2ff; color: #000; box-shadow: 0 0 40px rgba(0,210,255,0.6); transform: translateY(-3px); }

        /* SaÄŸ Ãœst Panel */
        #custom-panel {
            position: absolute; top: 0; right: -350px; width: 300px; height: 100%;
            background: rgba(0, 0, 0, 0.9); padding: 40px 25px;
            backdrop-filter: blur(20px); border-left: 1px solid rgba(255,255,255,0.1);
            z-index: 1100; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #custom-panel.active { right: 0; }
        .toggle-panel-btn { position: absolute; top: 30px; right: 30px; background: white; color: black; border: none; padding: 10px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; z-index: 1050; transition: 0.3s; }
        
        .input-group { margin-bottom: 25px; text-align: left; }
        .input-group label { display: block; font-size: 11px; text-transform: uppercase; color: #00d2ff; margin-bottom: 8px; }
        .input-group input { width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 10px; color: white; border-radius: 5px; }
        
        .play-custom { width: 100%; background: #00d2ff; border: none; padding: 15px; border-radius: 10px; color: black; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* Oyun Ä°Ã§i UI */
        #ui { position: absolute; top: 40px; left: 40px; font-size: 28px; font-weight: 900; z-index: 100; opacity: 0; transition: 0.5s; letter-spacing: 2px; }
        #guide { position: absolute; width: 35px; height: 35px; background: #fff; border-radius: 50%; transform: translate(-50%, -50%); z-index: 5; box-shadow: 0 0 20px white; display: none; transition: 0.15s ease-out; }
        #combo-ui { position: absolute; bottom: 50px; width: 100%; text-align: center; font-size: 60px; font-weight: 900; z-index: 100; pointer-events: none; opacity: 0; transition: 0.2s; color: #00d2ff; text-shadow: 0 0 25px rgba(0,210,255,0.5); }
        
        .note { position: absolute; width: 90px; height: 90px; border-radius: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: 45px; font-weight: 900; background: rgba(0, 0, 0, 0.8); z-index: 10; border: 4px solid; }
        .approach { position: absolute; border: 3px solid; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 11; }
        
        .shake { animation: shakeAnim 0.15s ease-in-out; }
        @keyframes shakeAnim { 0%, 100% { transform: translate(0, 0); } 25% { transform: translate(6px, 6px); } 75% { transform: translate(-6px, -6px); } }
        .hit-fx { transform: translate(-50%, -50%) scale(2.2) !important; opacity: 0 !important; transition: 0.4s ease-out !important; }
    </style>
</head>
<body>

    <div id="viewport">
        <div id="flash"></div>
        <video id="bg-video" muted loop playsinline></video>

        <button id="openBtn" class="toggle-panel-btn" onclick="togglePanel(true)">ðŸŽµ ÅžARKI EKLE</button>

        <div id="custom-panel">
            <button style="background:none; border:none; color:white; font-size:24px; cursor:pointer;" onclick="togglePanel(false)">âœ•</button>
            <h2 style="margin-top: 20px;">Qsu! Custom</h2>
            <div class="input-group">
                <label>MP3 DosyasÄ±</label>
                <input type="file" id="audioInput" accept="audio/*">
            </div>
            <div class="input-group">
                <label>MP4 DosyasÄ±</label>
                <input type="file" id="videoInput" accept="video/*">
            </div>
            <button class="play-custom" onclick="startCustom()">Qsu! BAÅžLAT â–¶</button>
        </div>

        <div id="menu">
            <div class="menu-content">
                <div class="version-badge">DEMO v2.0</div>
                <h1>Qsu!</h1>
                <p style="opacity: 0.4; margin-bottom: 40px; letter-spacing: 5px;">BEAT THE MUSIC</p>
                
                <div class="btn-list">
                    <button class="btn" onclick="start(1)">CRY FOR ME</button>
                    <button class="btn" onclick="start(2)">ENIGMATIC ENCOUNTER</button>
                    <button class="btn" onclick="start(3)">THE RESET (MEME)</button>
                </div>
            </div>
        </div>

        <div id="ui">
            SCORE: <span id="score">000000</span> 
            <span style="margin-left:20px; color:#00d2ff;">RANK: <span id="rank">C</span></span>
        </div>
        
        <div id="combo-ui">
            <span id="combo-count">0</span><br>
            <small style="font-size:15px; letter-spacing:8px; color:white;">COMBO</small>
        </div>
        
        <div id="guide"></div>
    </div>

    <audio id="music"></audio>

    <script>
        const music = document.getElementById('music');
        const guide = document.getElementById('guide');
        const scoreEl = document.getElementById('score');
        const rankEl = document.getElementById('rank');
        const flashEl = document.getElementById('flash');
        const bgVideo = document.getElementById('bg-video');
        const viewport = document.getElementById('viewport');
        const panel = document.getElementById('custom-panel');
        const openBtn = document.getElementById('openBtn');
        const ui = document.getElementById('ui');
        const comboCountEl = document.getElementById('combo-count');
        const comboUiEl = document.getElementById('combo-ui');
        
        let score = 0;
        let combo = 0;
        let isPlaying = false;
        let activeNotes = [];
        const sequence = [{code:"KeyD", label:"D", color:"#ff00ff"}, {code:"KeyF", label:"F", color:"#00d2ff"}, {code:"KeyJ", label:"J", color:"#ffff00"}, {code:"KeyK", label:"K", color:"#00ff00"}];
        let seqIndex = 0;

        function togglePanel(isOpen) {
            panel.classList.toggle('active', isOpen);
        }

        function getRank(s) {
            if (s > 60000) return 'SS';
            if (s > 40000) return 'S';
            if (s > 20000) return 'A';
            if (s > 10000) return 'B';
            return 'C';
        }

        function start(songId) {
            hideMenu();
            if (songId === 1) {
                music.src = "Cry For Me WA WA WA.mp3";
                bgVideo.src = "cryforme.mp4";
                launchGame(700);
            } else if (songId === 2) {
                music.src = "[HQ] An Enigmatic Encounter V2 - Undertale Last Breath (Phase 3).mp3";
                bgVideo.src = "enigmatic.mp4";
                launchGame(480);
            } else if (songId === 3) {
                music.src = "Girlfriends - New Computers.mp3";
                bgVideo.src = "THE RESET.mp4";
                launchGame(500);
            }
        }

        function startCustom() {
            const audioFile = document.getElementById('audioInput').files[0];
            const videoFile = document.getElementById('videoInput').files[0];
            if (!audioFile) return alert("MÃ¼zik seÃ§!");
            hideMenu();
            music.src = URL.createObjectURL(audioFile);
            if (videoFile) bgVideo.src = URL.createObjectURL(videoFile);
            launchGame(600);
        }

        function hideMenu() {
            document.getElementById('menu').style.opacity = '0';
            setTimeout(() => document.getElementById('menu').style.display = 'none', 500);
            panel.classList.remove('active');
            openBtn.style.display = 'none';
            ui.style.opacity = '1';
            guide.style.display = 'block';
        }

        function launchGame(spawnRate) {
            bgVideo.load();
            bgVideo.play();
            bgVideo.classList.add('pulse-active');
            music.play().then(() => {
                isPlaying = true;
                const producer = () => {
                    if(!isPlaying) return;
                    if(activeNotes.length < 3) moveAndSpawn();
                    setTimeout(producer, spawnRate);
                };
                producer();
                gameLoop();
            });
        }

        function triggerShake() {
            viewport.classList.remove('shake');
            void viewport.offsetWidth; 
            viewport.classList.add('shake');
            combo = 0;
            comboUiEl.style.opacity = "0";
        }

        function moveAndSpawn() {
            let x = Math.random() * (window.innerWidth - 300) + 150;
            let y = Math.random() * (window.innerHeight - 300) + 150;
            guide.style.left = x + 'px'; guide.style.top = y + 'px';

            const item = sequence[seqIndex];
            const nEl = document.createElement('div');
            nEl.className = 'note'; nEl.style.left = x+'px'; nEl.style.top = y+'px';
            nEl.style.color = item.color; nEl.style.borderColor = item.color; nEl.innerText = item.label;

            const aEl = document.createElement('div');
            aEl.className = 'approach'; aEl.style.left = x+'px'; aEl.style.top = y+'px';
            aEl.style.borderColor = item.color;

            viewport.appendChild(nEl); viewport.appendChild(aEl);
            activeNotes.push({ el: nEl, app: aEl, code: item.code, scale: 4.0, hit: false });
            seqIndex = (seqIndex + 1) % sequence.length;
        }

        function gameLoop() {
            if (!isPlaying) return;
            activeNotes.forEach((n, i) => {
                if (!n.hit) {
                    n.scale -= 0.052;
                    n.app.style.width = (90 * n.scale) + 'px';
                    n.app.style.height = (90 * n.scale) + 'px';
                    if (n.scale <= 0.7) {
                        triggerShake();
                        n.el.remove(); n.app.remove();
                        activeNotes.splice(i, 1);
                    }
                }
            });
            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('keydown', (e) => {
            if (!isPlaying) return;
            const idx = activeNotes.findIndex(n => n.code === e.code && n.scale > 0.7 && n.scale < 2.8 && !n.hit);
            if (idx !== -1) {
                const n = activeNotes[idx];
                n.hit = true; 
                score += 300;
                combo++;
                
                // Cila: Flash & UI Update
                flashEl.style.opacity = "0.2";
                setTimeout(() => flashEl.style.opacity = "0", 100);
                
                comboCountEl.innerText = combo;
                comboUiEl.style.opacity = "1";
                scoreEl.innerText = score.toString().padStart(6, '0');
                rankEl.innerText = getRank(score);

                n.el.classList.add('hit-fx'); n.app.remove();
                setTimeout(() => { n.el.remove(); activeNotes = activeNotes.filter(item => item !== n); }, 300);
            } else if (["KeyD","KeyF","KeyJ","KeyK"].includes(e.code)) {
                triggerShake();
            }
        });
    </script>
</body>
</html>
